<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.canvas.Canvas?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.electrical.controller.VoltageDividerController"
            styleClass="main-container">

    <!-- Верхняя панель -->
    <top>
        <HBox styleClass="header-panel" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            <Button fx:id="backButton" 
                    text="← Назад" 
                    onAction="#handleBack" 
                    styleClass="back-button"/>
            <Label text="Калькулятор делителя напряжения" styleClass="header-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label text="Vout = Vin × R2 / (R1 + R2)" styleClass="formula-hint"/>
        </HBox>
    </top>

    <!-- Центральная часть -->
    <center>
        <HBox spacing="20">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>

            <!-- Левая панель - параметры -->
            <VBox styleClass="input-panel" spacing="15" minWidth="300" maxWidth="320">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <Label text="Параметры" styleClass="panel-title"/>

                <!-- Входное напряжение -->
                <VBox spacing="5">
                    <Label text="Входное напряжение Vin (В)" styleClass="field-label"/>
                    <TextField fx:id="vInField" promptText="Например: 12" styleClass="input-field"/>
                </VBox>

                <!-- Выходное напряжение -->
                <VBox spacing="5">
                    <Label text="Требуемое Vout (В)" styleClass="field-label"/>
                    <TextField fx:id="vOutField" promptText="Например: 5" styleClass="input-field"/>
                </VBox>

                <!-- Допуск -->
                <VBox spacing="5">
                    <Label text="Допустимое отклонение (%)" styleClass="field-label"/>
                    <TextField fx:id="toleranceField" promptText="Например: 1" styleClass="input-field"/>
                </VBox>

                <!-- Ряд резисторов -->
                <VBox spacing="5">
                    <Label text="Ряд резисторов" styleClass="field-label"/>
                    <ComboBox fx:id="seriesCombo" styleClass="input-combo" maxWidth="Infinity"/>
                </VBox>

                <!-- Диапазон сопротивлений -->
                <VBox spacing="5">
                    <Label text="Минимальное сопротивление" styleClass="field-label"/>
                    <HBox spacing="10">
                        <TextField fx:id="minResistanceField" promptText="100" styleClass="input-field" HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="minResUnitCombo" styleClass="unit-combo" prefWidth="80"/>
                    </HBox>
                </VBox>

                <VBox spacing="5">
                    <Label text="Максимальное сопротивление" styleClass="field-label"/>
                    <HBox spacing="10">
                        <TextField fx:id="maxResistanceField" promptText="1" styleClass="input-field" HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="maxResUnitCombo" styleClass="unit-combo" prefWidth="80"/>
                    </HBox>
                </VBox>

                <Label fx:id="errorLabel" styleClass="error-label" wrapText="true"/>

                <!-- Кнопки -->
                <HBox spacing="10" alignment="CENTER">
                    <Button fx:id="calculateButton" 
                            text="Рассчитать" 
                            onAction="#handleCalculate" 
                            styleClass="primary-button"
                            HBox.hgrow="ALWAYS"
                            maxWidth="Infinity"/>
                    <Button fx:id="clearButton" 
                            text="Очистить" 
                            onAction="#handleClear" 
                            styleClass="secondary-button"/>
                </HBox>

                <HBox alignment="CENTER" spacing="10">
                    <ProgressIndicator fx:id="progressIndicator" prefWidth="24" prefHeight="24"/>
                    <Label fx:id="statusLabel" styleClass="status-label"/>
                </HBox>
            </VBox>

            <!-- Центральная панель - таблица результатов -->
            <VBox styleClass="results-panel" spacing="10" HBox.hgrow="ALWAYS">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <Label text="Результаты подбора" styleClass="panel-title"/>

                <TableView fx:id="resultsTable" VBox.vgrow="ALWAYS" styleClass="results-table">
                    <columns>
                        <TableColumn fx:id="indexColumn" text="#" prefWidth="40" sortable="false"/>
                        <TableColumn fx:id="vOutColumn" text="Vout" prefWidth="90"/>
                        <TableColumn fx:id="errorColumn" text="Погр." prefWidth="70"/>
                        <TableColumn fx:id="upperColumn" text="R верхнее" prefWidth="140"/>
                        <TableColumn fx:id="lowerColumn" text="R нижнее" prefWidth="140"/>
                        <TableColumn fx:id="countColumn" text="Кол-во" prefWidth="60"/>
                        <TableColumn fx:id="typeColumn" text="Тип" prefWidth="60"/>
                    </columns>
                </TableView>

                <HBox alignment="CENTER_RIGHT">
                    <Button fx:id="saveButton" 
                            text="Сохранить в историю" 
                            onAction="#handleSave" 
                            styleClass="save-button"/>
                </HBox>
            </VBox>

            <!-- Правая панель - схема -->
            <VBox fx:id="schemaBox" styleClass="schema-panel" spacing="10" minWidth="350" maxWidth="400">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <Label text="Схема делителя" styleClass="panel-title"/>

                <Canvas fx:id="circuitCanvas" width="350" height="350" styleClass="circuit-canvas"/>

                <Label fx:id="schemaInfoLabel" styleClass="schema-info" wrapText="true"/>
            </VBox>
        </HBox>
    </center>

</BorderPane>


